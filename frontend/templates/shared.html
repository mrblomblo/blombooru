<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shared Content - {{ app_name }}</title>
    
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/static/css/main.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        'primary-hover': '#2563eb',
                        background: '#0f172a',
                        surface: '#1e293b',
                        'surface-hover': '#334155',
                        border: '#334155',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-[#0f172a] text-[#f1f5f9] text-xs">
    <div class="container mx-auto px-4 py-4">
        <div class="bg-amber-600 text-black p-3 mb-4 flex items-center gap-2 text-xs">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
            </svg>
            <span class="font-bold">This content has been shared with you.</span>
        </div>
        
        <div id="shared-content"></div>
    </div>
    
    <script>
        const shareUuid = '{{ share_uuid }}';
        
        async function loadSharedContent() {
            try {
                const response = await fetch(`/api/shared/${shareUuid}`);
                const data = await response.json();
                
                if (data.type === 'media') {
                    renderSharedMedia(data.data);
                }
            } catch (error) {
                console.error('Error loading shared content:', error);
                document.getElementById('shared-content').innerHTML = `
                    <div class="text-center py-16">
                        <h2 class="text-lg font-bold mb-2">Content Not Found</h2>
                        <p class="text-xs text-[#94a3b8]">This shared link is invalid or has been removed.</p>
                    </div>
                `;
            }
        }
        
        function renderSharedMedia(media) {
            const container = document.getElementById('shared-content');
            
            container.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-4">
                    <div class="lg:col-span-3">
                        <div class="bg-[#1e293b] p-4 border border-[#334155] text-center">
                            ${media.file_type === 'video' ? `
                                <video controls style="max-width: 100%; max-height: 80vh; margin: 0 auto;">
                                    <source src="/api/shared/${shareUuid}/file" type="${media.mime_type}">
                                </video>
                            ` : `
                                <img src="/api/shared/${shareUuid}/file" alt="${media.filename}" style="max-width: 100%; max-height: 80vh; margin: 0 auto;">
                            `}
                        </div>
                    </div>
                    
                    <div class="lg:col-span-1">
                        <div class="bg-[#1e293b] p-3 border border-[#334155]">
                            <h3 class="text-sm font-bold mb-3 pb-2 border-b border-[#334155]">Information</h3>
                            <div class="info-row">
                                <span>Type</span>
                                <strong>${media.file_type}</strong>
                            </div>
                            <div class="info-row">
                                <span>Size</span>
                                <strong>${formatFileSize(media.file_size)}</strong>
                            </div>
                            ${media.width && media.height ? `
                                <div class="info-row">
                                    <span>Dimensions</span>
                                    <strong>${media.width}x${media.height}</strong>
                                </div>
                            ` : ''}
                            ${media.duration ? `
                                <div class="info-row">
                                    <span>Duration</span>
                                    <strong>${formatDuration(media.duration)}</strong>
                                </div>
                            ` : ''}
                            
                            <div class="mt-4">
                                <a href="/api/shared/${shareUuid}/file" download="${media.filename}" class="block w-full px-3 py-2 bg-[#334155] hover:bg-[#475569] text-white text-center text-xs">
                                    Download
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function showLightbox(media) {
            const lightbox = document.createElement('div');
            lightbox.className = 'fixed inset-0 bg-black bg-opacity-95 z-50 flex items-center justify-center p-8';
            
            lightbox.innerHTML = `
                <div class="max-w-[90vw] max-h-[90vh] relative">
                    ${media.file_type === 'video' ? `
                        <video controls class="max-w-full max-h-[90vh]">
                            <source src="/api/media/${media.id}/file" type="${media.mime_type}">
                        </video>
                    ` : `
                        <img src="/api/media/${media.id}/file" class="max-w-full max-h-[90vh]">
                    `}
                    <button onclick="this.parentElement.parentElement.remove()" 
                            class="absolute -top-8 -right-8 bg-red-600 hover:bg-red-700 px-4 py-2 text-white text-xs cursor-pointer">
                        Close
                    </button>
                </div>
            `;
            
            lightbox.addEventListener('click', (e) => {
                if (e.target === lightbox) {
                    lightbox.remove();
                }
            });
            
            document.body.appendChild(lightbox);
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }
        
        function formatDuration(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        loadSharedContent();
    </script>
    
    <style>
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.7rem;
        }
        
        .gallery-item {
            position: relative;
            aspect-ratio: 1;
            overflow: hidden;
            border: 1px solid var(--border);
        }
        
        .gallery-item:hover {
            border-color: var(--primary-color);
        }
        
        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</body>
</html>

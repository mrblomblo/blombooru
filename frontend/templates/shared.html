<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shared Content - {{ app_name }}</title>
    
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="stylesheet" href="/static/css/pico.min.css">
    <link rel="stylesheet" href="/static/css/main.css">
</head>
<body>
    <div class="container" style="margin-top: 2rem;">
        <div class="shared-notice">
            <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
            </svg>
            <span>This content has been shared with you.</span>
        </div>
        
        <div id="shared-content"></div>
    </div>
    
    <script>
        const shareUuid = '{{ share_uuid }}';
        
        async function loadSharedContent() {
            try {
                const response = await fetch(`/api/shared/${shareUuid}`);
                const data = await response.json();
                
                if (data.type === 'media') {
                    renderSharedMedia(data.data);
                } else if (data.type === 'album') {
                    renderSharedAlbum(data.data, data.media);
                }
            } catch (error) {
                console.error('Error loading shared content:', error);
                document.getElementById('shared-content').innerHTML = `
                    <div style="text-align: center; padding: 4rem;">
                        <h2>Content Not Found</h2>
                        <p>This shared link is invalid or has been removed.</p>
                    </div>
                `;
            }
        }
        
        function renderSharedMedia(media) {
            const container = document.getElementById('shared-content');
            
            container.innerHTML = `
                <div class="media-detail">
                    <div class="media-content">
                        ${media.file_type === 'video' ? `
                            <video controls>
                                <source src="/api/shared/${shareUuid}/file" type="${media.mime_type}">
                            </video>
                        ` : `
                            <img src="/api/shared/${shareUuid}/file" alt="${media.filename}">
                        `}
                    </div>
                    
                    <div class="media-sidebar">
                        <h3>Information</h3>
                        <div class="info-row">
                            <span>Type</span>
                            <strong>${media.file_type}</strong>
                        </div>
                        <div class="info-row">
                            <span>Size</span>
                            <strong>${formatFileSize(media.file_size)}</strong>
                        </div>
                        ${media.width && media.height ? `
                            <div class="info-row">
                                <span>Dimensions</span>
                                <strong>${media.width}x${media.height}</strong>
                            </div>
                        ` : ''}
                        ${media.duration ? `
                            <div class="info-row">
                                <span>Duration</span>
                                <strong>${formatDuration(media.duration)}</strong>
                            </div>
                        ` : ''}
                        
                        <div style="margin-top: 2rem;">
                            <a href="/api/shared/${shareUuid}/file" download="${media.filename}" class="btn btn-secondary">
                                Download
                            </a>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderSharedAlbum(album, media) {
            const container = document.getElementById('shared-content');
            
            container.innerHTML = `
                <div style="margin-bottom: 2rem;">
                    <h1>${album.name}</h1>
                    ${album.description ? `<p style="color: var(--text-secondary);">${album.description}</p>` : ''}
                    <p><strong>${media.length}</strong> items</p>
                </div>
                
                <div class="gallery-grid">
                    ${media.map(item => `
                        <div class="gallery-item ${item.file_type}">
                            <img src="/api/media/${item.id}/thumbnail" alt="${item.filename}">
                        </div>
                    `).join('')}
                </div>
            `;
            
            // Add click handlers to open media in lightbox
            container.querySelectorAll('.gallery-item').forEach((item, index) => {
                item.style.cursor = 'pointer';
                item.addEventListener('click', () => {
                    showLightbox(media[index]);
                });
            });
        }
        
        function showLightbox(media) {
            const lightbox = document.createElement('div');
            lightbox.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.95);
                z-index: 9999;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 2rem;
            `;
            
            lightbox.innerHTML = `
                <div style="max-width: 90vw; max-height: 90vh; position: relative;">
                    ${media.file_type === 'video' ? `
                        <video controls style="max-width: 100%; max-height: 90vh;">
                            <source src="/api/media/${media.id}/file" type="${media.mime_type}">
                        </video>
                    ` : `
                        <img src="/api/media/${media.id}/file" style="max-width: 100%; max-height: 90vh;">
                    `}
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="position: absolute; top: -2rem; right: -2rem; background: var(--danger); border: none; color: white; padding: 0.5rem 1rem; border-radius: 0.25rem; cursor: pointer;">
                        Close
                    </button>
                </div>
            `;
            
            lightbox.addEventListener('click', (e) => {
                if (e.target === lightbox) {
                    lightbox.remove();
                }
            });
            
            document.body.appendChild(lightbox);
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }
        
        function formatDuration(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        loadSharedContent();
    </script>
</body>
</html>

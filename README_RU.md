<p align="center"><img width="830" alt="Blombooru Banner" src="https://github.com/user-attachments/assets/a13b7b6d-f7e5-4251-a14c-4bf8b069a366" /></p>

<div align="center">
  
  ![Python Version](https://img.shields.io/badge/Python-3.10%2B-blue?style=flat-square&logo=python&logoColor=white)
  ![FastAPI](https://img.shields.io/badge/FastAPI-005571?style=flat-square&logo=fastapi)
  ![Redis](https://img.shields.io/badge/Redis-7+-FF4235?style=flat-square&logo=redis&logoColor=white)
  ![PostgreSQL](https://img.shields.io/badge/PostgreSQL-17-2F6792?style=flat-square&logo=postgresql&logoColor=white)
  ![TailwindCSS](https://img.shields.io/badge/Tailwind_CSS-38B2AC?style=flat-square&logo=tailwind-css&logoColor=white)
  ![Docker](https://img.shields.io/badge/Docker-ready-blue?style=flat-square&logo=docker&logoColor=white)
  ![License](https://img.shields.io/badge/License-MIT-green?style=flat-square)
  
</div>

<p align="center"><b>Ваш персональный, Self-Hosted инструмент для разметки медиафайлов.</b></p>

Blombooru - приватная, single-user альтернатива Booru-like доскам (R34, Danbooru или Gelbooru). Она разработана для тех, кому нужно мощное, легкое в использовании и современное решения для организации и маркировки личной коллекции медиа. Благодаря удобному интерфейсу, гибкому администрированию и простой кастомизации Blombooru даёт вам полный контроль над вашей коллекцией.

> [!NOTE]
> Локализация на русский язык: @cobaltcobaltcobalt

<details>
<summary>Скриншоты:</summary>

**Домашняя страница**
<img width="1920" alt="Homepage" src="https://github.com/user-attachments/assets/eaa9b99e-ff64-439f-bb00-e5a37c53db3a" />

**Страница просмотра медиа**
<img width="1920" alt="Media-viewer page" src="https://github.com/user-attachments/assets/c3dcebf7-2cee-475b-b428-54986a27c42c" />

**Страница публичного медиа**
<img width="1920" alt="Shared media page" src="https://github.com/user-attachments/assets/6fa43d69-eb44-46a4-85b4-99e85322fbea" />

**Панель администратора**
<img width="1920" alt="Admin panel" src="https://github.com/user-attachments/assets/19db7c83-bbcb-48c6-a505-78f03ea6964e" />

</details>

## Содержание

- [Ключевые особенности](#ключевые-особенности)
- [Установка и настройка](#установка-и-настройка)
  - [Docker](#docker)
    - [Несколько инстансов](#несколько-инстансов)
  - [Python](#python)
- [Использование](#использование)
  - [Вход в систему](#вход-в-систему)
  - [Режим администратора](#режим-администратора)
  - [Добавление тегов](#добавление-тегов)
  - [Загрузка медиа](#загрузка-медиа)
  - [Простановка тегов и поиск](#простановка-тегов-и-поиск)
  - [Общий доступ](#общий-доступ)
  - [Обновление системы](#обновление-системы)
  - [API и сторонние приложения](#api-и-сторонние-приложения)
- [Темы](#темы)
- [Технические детали](#технические-детали)
- [Отказ от ответственности](#отказ-от-ответственности)
- [Лицензия](#лицензия)

## Ключевые особенности

### Основные функции

- **Теги как в Danbooru:** Знакомая и мощная система тегов по категориям (художник, персонаж, автор и т. д.), поиском по тегам и исключениям тегов.

- **Простой импорт тегов:** Доступен импорт пользовательских списков тегов в CSV через панель администратора, чтобы ваша коллекция всегда была актуальной.

- **Альбомы:** Могут содержать как медиафайлы, так и другие подальбомы для неограниченного вложения (рекурсия!) и простой организации.

- **Связи между медиафайлами:** Создавайте связи «родитель-потомок». Группируйте варианты изображений, многостраничные комиксы и многое другое, чтобы связанный контент был легко доступен.

- **Импорт с внешних Booru:** С легкостью импортируйте посты с Danbooru и других booru-like сайтов (таких как Danbooru, Gelbooru и т. д.), просто вставив ссылку на пост. Теги, рейтинг, источник и медиафайлы автоматически загружаются и сопоставляются.

### ИИ и автоматизация

- **AI-Friendly:** Легко просматривайте сопутствующие метаданные ИИ для практически любых медиафайлов, созданных с помощью SwarmUI, ComfyUI, A1111 и других. Также, вы можете добавлять теги в редактор прямо из промпта.

- **Автоматическое тегирование:** Быстрая маркировка с помощью интеграции WDv3 Auto Tagger, анализирующей изображения и предлагающей точные теги одним кликом.

### Безопасность и общий доступ

- **Приватный режим:** Если включен, пользователи должны войти в аккаунт для взаимодействия с Blombooru. Публичные ссылки и статичные файлы остаются общедоступными. Просто для владельца коллекции, недоступно посторонним.

- **Защита от изменений:** Просматривайте свою коллекцию, не боясь что-либо изменить. Все подобные действия требуют входа под логином администратора.

- **Безопасный обмен медиафайлами:** Создавайте уникальные постоянные ссылки, для того, чтобы поделиться конкретными постами. Публичные ссылки представлены в урезаном, безопасном виде, с возможностью дополнительного показа AI метаданных.

### Кастомизация и темы

- **Современный и быстрый UI:** Построен на Tailwind CSS для красивого и надёжного использования на ПК и мобильных устройствах.

- **Крайне простая кастомизация:** Настройте внешний вид с помощью простого CSS. Добавьте новые файлы `.css` в папку `themes`, внесите их в `themes.py` и перезапустите Blombooru.

- **Много встроенных тем:** В Blombooru уже вшито 4 Catppuccin темы, Gruvbox light & dark, Everforest light & dark, OLED и другие!

### Гибкость и интеграции

- **Гибкость в загрузке медиа:** Добавляйте медиафайлы через drag-and-drop, импортируя архив или положитесь на автоматику: лежащие в директории файлы будут добавлены автоматически по нажатию кнопки "Сканирование неотслеженных медиафайлов"

- **Быстрый старт:** Простой процесс OOBE для настройки аккаунта администратора, базы данных и названия вашей копии Blombooru

- **Высокопроизводительное кеширование:** Опциональная интеграция с Redis обеспечивает молниеносное время отклика для сложных запросов, автозаполнения и Danbooru-совместимых API вызовов.

- **Общая БД тегов:** Возможность использовать одни и те же теги в нескольких инстансах Blombooru используя выделенную PostgreSQL базу данных

- **Danbooru v2 API совместимость:** Используйте Blombooru с вашим любимым third-party Booru клиентом (Grabber, Tachiyomi, или BooruNav)

## Установка и настройка

Вы можете использовать Blombooru в Docker контейнере *(рекомендовано)* или запускать напрямую из Python.

### Docker

Это рекомендуемый метод для использования Blombooru. Предварительно собранные образы доступны к загрузке на GitHub Container Registry.

| Требование | Пометка |
|:-------------|:------|
| Docker | Требуется |

#### Варианты образов

| Варианты | Тег образа | Применение |
|:-------|:----------|:---------|
| **Последний стабилный** | `latest` (по умолчанию) | общее применение, отслеживает последний релиз с GitHub |
| **Pre-release** | `pre` | тестирование будущих версий, отслеживает последний pre-release с GitHub |
| **Точная версия** | `1.2.3` / `1.2` / `1` | привязка к указанной стабильной версии |
| **Точный Pre-release** | `1.2.3-rc.1` | привязка к указанному pre-release |
| **Для разработчиков** | Собирается локально | внесение изменений в исходный код |


#### Быстрый старт (готовый образ)

1. **Подготовка файлов**

    Создайте папку для Blombooru (к примеру, `blombooru`), затем загрузите файлы `docker-compose.yml` и `example.env` с [последнего релиза](https://github.com/mrblomblo/blombooru/releases/latest) и положите их в эту папку.

2. **Настройка среды**  
    Создайте копию `example.env` и переименуйте в `.env`. После, откройте эту копию в текстовом редакторе и измените значения, идущие после  `=` на всех строках. Самое важное, что необходимо поменять, это пароль в поле `POSTGRES_PASSWORD`. Остальные значения можно не трогать, если вы уверены, что не будет конфликтов. (к примеру, порт 8000 уже используется другим софтом)

3. **Первый запуск и настройка**  
    Запустите Docker контейнер (убедитесь, что находитесь в той папке, куда поместили `docker-compose.yml`):

    ```bash
    docker compose up -d
    ```

    *Возможно, вам нужно будет выполнить это как `sudo`*

    После, откройте браузер и перейдите по `http://localhost:<port>` (где `<port>` - это порт, который вы указали в `.env`). Откроется страница первой настройки. Теперь необходимо:
    - Установить имя пользователя и пароль администратора.
    - Ввести данные от PostgreSQL. Сервер попробует подключиться к ней перед продолжением настройки. Если вы не меняли `POSTGRES_DB` и/или `POSTGRES_USER`, вам потребуется только заполнить пароль, который вы указывали в `.env`. Не меняйте DB Host.
    - *(опционально)* Включите и настройте кеширование через Redis.
    - Настройте название сайта (по умолчанию - "Blombooru").

    После настройки, сервер создаст БД и аккаунт администратора.

4. **Перезапуск приложения**  
    После первого запуска и настройки, вы можете запускать сервер, используя:
    
    ```bash
    docker compose up -d
    ```

    *Возможно, вам нужно будет выполнить это как `sudo`*
    
    Имейте в виду, что эту команду также необходимо выполнять из директории, где находится `docker-compose.yml`

    Все настройки сохраняются в `settings.json` файл в папке `data`, а все загруженные медиа - в `media/original`. Эти папки не будет легкодоступными и находятся не в корне папки с Blombooru.

5. **Выключение сервера**

    ```bash
    docker compose down
    ```

#### Использование Pre-release сборок

Для того, чтобы запустить последнюю pre-release версию, установите переменную `BLOMBOORU_TAG` следующим образом:

```bash
BLOMBOORU_TAG=pre docker compose up -d
```

Или добавьте `BLOMBOORU_TAG=pre` в файл `.env`

> [!WARNING]
> Pre-release сборки могут содержать критические изменения или баги. Используйте их только для тестирования будущих версий.

#### Сборка для разработки (локально)

Для контрибьюторов или всех, кто желает собрать проект из исходников:

1. ```bash
    git clone https://github.com/mrblomblo/blombooru.git
    cd blombooru
    ```
   
2. ```bash
    docker compose -f docker-compose.dev.yml up --build -d
    ```

Таким образом, Docker будет использовать `docker-compose.dev.yml`, который соберется на основе локальных исходников.

#### Несколько инстансов

Если вам необходимо запускать несколько инстансов Blombooru (к примеру, для разделения БД по разным типам файлов или для разных пользователей), Docker Compose позволит сделать это. Каждый инстанс будет иметь собственную изолированую БД, Redis кеш, хранилище медиа и конфигурацию.

**Требования:**
- Хотя бы один полностью настроенный инстанс (см. выше)
- Базовые навыки работы в консоли

**Инструкция:**

1. **Создайте отдельные директории для каждого инстанса**  
    Каждый инстанс должен иметь собственную папку для корректного изолирования:

    ```bash
    mkdir -p ~/blombooru-instance1
    mkdir -p ~/blombooru-instance2
    cd ~/blombooru-instance1
    ```

2. **Настройте файлы для кадого инстанса**  
    Скопируйте `docker-compose.yml` и `example.env` файлы в каждую из директорий:

    ```bash
    # Это пример, замените действительными путями к файлам
    cp ~/blombooru/docker-compose.yml ~/blombooru/example.env ~/blombooru-instance1/
    cp ~/blombooru/docker-compose.yml ~/blombooru/example.env ~/blombooru-instance2/

3. **Настройте уникальные порты для каждого инстанса**  
    Создайте `.env` файл в каждой директории (скопируйте из `example.env`) и назначьте **отличные порты** во избежание конфликтов:

    **Инстанс 1** (`~/blombooru-instance1/.env`):
    ```env
    APP_PORT=8000
    POSTGRES_PORT=5432
    REDIS_PORT=6379
    POSTGRES_PASSWORD=your_secure_password_here
    # ... other settings
    ```

    **Инстанс 2** (`~/blombooru-instance2/.env`):
    ```env
    APP_PORT=8001
    POSTGRES_PORT=5433
    REDIS_PORT=6380
    POSTGRES_PASSWORD=different_secure_password
    # ... other settings
    ```

> [!IMPORTANT]
> Каждый инстанс обязан иметь уникальные значения для `APP_PORT`, `POSTGRES_PORT`, и `REDIS_PORT`. Использование одинаковых портов вызовет конфликт и не даст запустить серверы.

> [!NOTE] 
> `POSTGRES_PORT` и `REDIS_PORT` используются **только** для маппинга портов до вашего хост-компьютера, либо для внешнего PostgreSQL или Redis сервера, использующего другой порт. Внутри Docker, контейнеры всегда обмениваются данными по стандартным портам (PostgreSQL: `5432`, Redis: `6379`).

4. **Запустите каждый инстанс по отдельности**  
    Перейдите в корневую папку каждого инстанса и запустите через Docker Compose:

    ```bash
    cd ~/blombooru-instance1
    docker compose up --build -d
    ```

    ```bash
    cd ~/blombooru-instance2
    docker compose up --build -d
    ```

    Docker Compose автоматически задаст названия, исходя из названия директории (e.g., `blombooru-instance1-web-1`, `blombooru-instance2-web-1`), тем самым избежав конфликта

5. **Завершите первую настройку на каждом инстансе**  
    Как было описано ранее, каждый инстанс существует независимо, поэтому вам нужно будет пройти первоначальную настройку по отдельности.
    - Инстанс 1: `http://localhost:8000`
    - Инстанс 2: `http://localhost:8001`

**Управление несколькими инстансами:**

- **Посмотреть список запущенных:**  
    ```bash
    docker ps
    ```

- **Остановить конкретный:**  
    ```bash
    cd ~/blombooru-instance1
    docker compose down
    ```

- **Посмотреть логи для конкретного:**  
    ```bash
    cd ~/blombooru-instance1
    docker compose logs -f
    ```

- **Обновить конкретный:**  
    Перейдите в директорию инстанса и используйте автоматическое обновление из панели администратора, или вручную:
    ```bash
    cd ~/blombooru-instance1
    git pull
    docker compose down && docker compose up --build -d
    ```

**Изолирование данных:**

Каждый инстанс существует по отдельности:
- **БД** – Хранятся в Docker дисках, названных по имени директории (e.g., `blombooru-instance1_pgdata`)
- **Медиафайлы** – Хранятся в разделенных Docker дисках (e.g., `blombooru-instance1_media`)
- **Конфигурация** – У каждого инстанса собственный `settings.json` в Docker диске
- **Redis кеш** – Отдельные инстансы Redis с изолированными данными

Это значит, вы можете спокойно удалять, обновлять или изменять один инстанс, никак не затрагивая другие.

#### Общие теги между инстансами

Если вам требуется, чтобы несколько инстансов Blombooru имели одну и ту же БД тегов (таким образом, теги созданные в одном инстансе станут доступны в других), вы можете включить опцию **Общей БД тегов**, скачав файл `docker-compose.shared-tags.yml` из [последнего релиза](https://github.com/mrblomblo/blombooru/releases/latest), поместив его в ту же директорию, где находится один из ваших `docker-compose.yml` файлов и выполнив следующие шаги (также, вы можете пропустить шаги 1 и 2 и использовать существующую БД PostgreSQL, если у вас она есть):


1. **Отредактируйте .env файл того инстанса, который будет хостом общей БД тегов:**
   - Поправьте следующие строки в `.env` файле инстанса:

   ```env
   SHARED_TAGS_ENABLED=false # установите в true для включения фичи
   SHARED_TAG_DB_USER=postgres
   SHARED_TAG_DB_PASSWORD=supersecretsharedtagdbpassword # смените на надёжный пароль
   SHARED_TAG_DB=shared_tags
   SHARED_TAG_DB_HOST=shared-tag-db
   SHARED_TAG_DB_PORT=5431 # смените на другой порт в случае необходимости

2. **Запустите контейнер общей БД:**
   ```bash
   docker compose -f docker-compose.shared-tags.yml up -d
   ```

3. **Настройте каждый из инстансов Blombooru:**
   - Перейдите в **Панель администратора > Система**
   - Включите "Общая БД тегов"
   - Введите параметры подключения
   - Нажмите "Проверить подключение", убедитесь, что всё работает и сохраните

3. **Синхронизация тегов:**
   - Нажмите кнопку "Синхронизировать сейчас", чтобы вручную синхронизировать теги между инстансами
   - Новые теги автоматически синхронизируются при создании

> [!NOTE]
> Локальные теги всегда имеют более высокий приоритет. Если тег существует локально с категорией, отличающейся от той, к которой относится тег из общей БД - используется локальная категория.
> **Теги никогда не удаляются из локальных БД, импортируются только новые теги.**

### Python

> [!NOTE]
> Использование Python рекомендовано для разработки, но может пригодиться в случае, если вам доступны venv-ы, а Docker - нет.

| Требование | пометка |
|:-------------|:------|
| Python 3.10+ | Протестировано на 3.13.7 & 3.11. **НЕ** работает с 3.14. |
| PostgreSQL 17 | Требуется |
| Redis 7+ | Опционально |
| Git | Рекомендуется (иначе воспользуйтесь кнопкой Code -> Download .ZIP) |

1. **Клонируйте репозиторий**

    ```bash
    git clone https://github.com/mrblomblo/blombooru.git
    cd blombooru
    ```

2. **Создайте виртуальную среду и установите зависимости**

    ```bash
    python -m venv venv
    source venv/bin/activate  # на Windows, пользуйтесь `venv\Scripts\activate`
    pip install -r requirements.txt
    ```

3. **Создайте БД PostgreSQL**  
    Создайте новую БД и пользователя с правами к этой БД, Blombooru разметит всё сам.

4. **Запустите инстанс Redis** *(опционально)*  
    Если вам необходимо кеширование, у вас должен быть Redis (v7+) сервер. Вы можете установить его встроенным менеджером пакетов (e.g., `apt install redis`, `brew install redis`) или запустить в отдельном Docker контейнере.

5. **Первый запуск и настройка**  
    Запустите сервер:

    ```bash
    python run.py
    ```

    После, откройте браузер и перейдите по `http://localhost:<port>` (где `<port>` - это порт, который вы указали в `.env`). Откроется страница первой настройки. Теперь необходимо:
    - Установить имя пользователя и пароль администратора.
    - Ввести данные от PostgreSQL. Сервер попробует подключиться к ней перед продолжением настройки. Если вы не меняли `POSTGRES_DB` и/или `POSTGRES_USER`, вам потребуется только заполнить пароль, который вы указывали в `.env`. Не меняйте DB Host.
    - *(опционально)* Включите и настройте кеширование через Redis.
    - Настройте название сайта (по умолчанию - "Blombooru").

    После настройки, сервер создаст БД и аккаунт администратора.

6. **Перезапуск приложения** 
    После первого запуска и настройки, вы можете запускать сервер той же командой. Все настройки сохраняются в `settings.json` файл в папке `data`, а все загруженные медиа - в `media/original`.

## Использование

### Вход в систему

Откройте веб-страницу и нажмите на кнопку **Панель администратора** в навбаре, затем войдите, используя аккаунт, созданный во время первоначальной настройки. Ваш логин сохранится в куки с большим сроком жизни для удобства.

### Режим администратора

Для внесения любых изменений, вам необходимо быть под учётной записью администратора. Это защитит вас от случайного удаления или изменения медиафайлов. У администратора есть права к:

- Загрузке, редактированию и удалению медиа
- Добавлению и удалению тегов
- Генерации публичных ссылок
- Выполнению массовых операций по отношению к БД
- Управление настройками системы, включая название, безопасность, Redis

### Добавление тегов

Есть два способа по добавлению новых тегов:

#### 1. CSV импорт

Используйте [этот скрипт](https://github.com/DraconicDragon/danbooru-e621-tag-list-processor) от DraconicDragon чтобы заскрейпить ваш список, или используйте один из списков [отсюда](https://civitai.com/models/950325/danboorue621-autocomplete-tag-lists-incl-aliases-krita-ai-support) или [отсюда](https://github.com/DraconicDragon/dbr-e621-lists-archive/tree/main/tag-lists/danbooru).

> [!IMPORTANT]
> Убедитесь, что ваш CSV имеет формат, указанный в секции "Импорт тегов из CSV" (ниже). В данный момент, только "Danbooru"-подобные CSV списки (сгенерированные скриптом или скачанные выше) совместимы.

<img width="1920" alt="'Импорт тегов из CSV'" src="https://github.com/user-attachments/assets/9c7b63f8-e5b7-4438-811f-8f1d9bd58725" />

#### 2. Ручное создание тегов
  
Вручную введите теги, которые хотите создать. Начните тег, к примеру, с `meta:`, чтобы поместить его в "мета" категорию. Прочие доступные префиксы тегов описаны в секции "Добавить теги"

*Дубликаты тегов автоматически отслеживаются и не будут добавлены.*

<img width="1920" alt="Секция 'Добавить теги'" src="https://github.com/user-attachments/assets/e4f618ea-0a40-4321-8656-8da3c3d2d5bc" />

### Загрузка медиа

У вас есть три способа для добавления нового контента:

#### 1. Медиафайлы

В панели администратора есть зона для загрузки, куда вы можете просто перетащить желаемые файлы. Альтернативно, вы можете открыть проводник и выбрать файлы через него.

#### 2. Сжатые архивы

Загрузите `.zip`, `.tar.gz`, или `.tgz` архив, содержащий ваши медиафайлы в то же окно, и Blombooru разархивирует и обработает их.

#### 3. Сканирование директории

Поместите ваши медиафайлы напрямую в настроенную директорию. Затем, перейдите в панель администратора и нажмите **"Сканирование неотслеженных медиафайлов"**. Сервер просканирует директорию `media/original`, найдёт новые файлы, автоматически сгенерирует предпросмотр и добавит их в вашу библиотеку.

*Дубликаты медиа отслеживаются по хешу и не будут добавлены.*

### Простановка тегов и поиск

- **Автозаполнение тегов:** При редактировании файла, начните печатать в поле ввода тега. Отобразится список предложений основанный на существующих тегах. 

- **Отображение тегов:** На странице медиа, теги автоматически отсортированы по категориям (Художник, Авторские права, Персонаж, Общие,Мета) и по алфавиту внутри каждой из категорий. 

- **Синтаксис поиска:** Blombooru поддерживает то же, что и Danbooru.

#### Базовые теги:

| Запрос | Описание |
|:-------|:------------|
| `tag1 tag2` | Поиск медиа с обоими тегами `tag1` И `tag2` |
| `-tag1` | Исключить медиа с тегом `tag1` |
| `tag*` | Wildcard-поиск (находит `tag_name`, `tag_stuff`, и т.д.) |
| `?tag` | Поиск медиа с одним или без символов перед `tag` |

#### Диапазоны

Большинство числовых и дата-фильтров поддерживают операции с диапазонами:

| Syntax | Description |
|:-------|:------------|
| `id:100` | Точное совпадение (`x == 100`) |
| `id:100..200` | Между (включительно) (`100 <= x <= 200`) |
| `id:>=100` | Больше или равно (`x >= 100`) |
| `id:>100` | Больше чем (`x > 100`) |
| `id:<=100` | Меньше или равно (`x <= 100`) |
| `id:<100` | Меньше чем (`x < 100`) |
| `id:1,2,3` | В списке (`x` = 1, 2, или 3) |

#### Мета-фильтры

| Фильтр | Описание | Пример(ы) |
|:----------|:------------|:-----------|
| `id` | Поиск по внутреннему ID | `id:100..200`, `id:>500` |
| `width`, `height` | Поиск по размеру в пикселях | `width:>=1920`, `height:1080` |
| `filesize` | Поиск по весу файла (принимает `kb`, `mb`, `gb`, `b`). Также поддерживается нечеткое совпадение: `filesize:52MB` найдёт от `52.0MB` до `52.99MB`. | `filesize:1mb..5mb`, `filesize:52MB` |
| `date` | Поиск по дате загрузки (`YYYY-MM-DD`) | `date:2024-01-01` |
| `age` | Поиск по возрасту (файла) по отношению к сегодня (`s`, `mi`, `h`, `d`, `w`, `mo`, `y`). Внимание: `<` подразумевает "новее, чем" (более молодой). | `age:<24h` (не старше чем 1 день назад), `age:1w..1mo` |
| `rating` | Фильтр по рейтингу: `s`/`safe`, `q`/`questionable`, `e`/`explicit`. Поддерживаются списки | `rating:s,q`, `-rating:e` |
| `source` | Поиск по источнику. Используйте `none` для отсутствующих источников, `http` для веб-сайтов | `source:none`, `source:http`, `source:twitter` |
| `filetype` | Поиск по расширению файла | `filetype:png`, `filetype:gif` |
| `md5` | Поиск по ТОЧНОМУ хешу файла | `md5:d34e4c...` |
| `pool`, `album` | Поиск по ID/Названию альбома или пула. `any`/`none` принимается. | `album:any`, `pool:favorites`, `pool:5` |
| `parent` | Поиск по ID родителя `any`/`none` принимается. | `parent:none`, `parent:123` |
| `child` | Фильтр родительских постов по дочерним. `any`/`none` принимается. | `child:any` (есть дочерние), `child:none` |
| `duration` | Поиск по длительности video/gif в секундах | `duration:>60` |

> [!NOTE]
> `duration` могут иметь не все GIF-файлы.

#### Количество тегов

Фильтрация по количеству тегов в посте:

| Фильтр | Описание |
|:----------|:------------|
| `tagcount` | Всего тегов |
| `gentags` | General тегов |
| `arttags` | Artist тегов |
| `chartags` | Character тегов |
| `copytags` | Copyright тегов |
| `metatags` | Meta тегов |

**Пример:** `tagcount:<10` (посты с небольшим кол-вом тегов), `arttags:>=1` (посты с как минимум одним artist (художник) тегом)

#### Сортировка

Сортируйте результаты, используя `order:{value}`. Суффикс `_asc` или `_desc` может быть применим. По умолчанию, обычно, descending

| Значение | Описание |
|:------|:------------|
| `id` / `id_desc` | Новейшие загрузки сначала (дефолт) |
| `id_asc` | Старейшие загрузки сначала |
| `filesize` | Файлы с наибольшим весом сначала |
| `landscape` | Ландшафтные (шир>выс) файлы сначала |
| `portrait` | Портретные (выс>шир) файлы сначала |
| `md5` | Сортировка по MD5 хешу (псевдо-случайная, воиспроизводимая) |
| `custom` | Сортировка по порядку из `id:list`. Пример: `id:3,1,2 order:custom` |

### Общий доступ

1. Войдите в аккаунт администратора
2. Перейдите на страницу файла, которым хотите поделиться.
3. Нажмите на кнопку **Поделиться** и уникальная ссылка вида (`https://localhost:8000/shared/<uuid>`) будет создана
4. Любой, кто перейдёт по этой ссылке, сможет просмотреть этот файл в упрощенном read-only виде. Файлы, которыми вы поделились могут на ваш выбор включать или исключать приложенные к ним AI метаданные. Такие посты будут иметь пометку "ОБЩ. ДОСТУП" в вашей галерее.

### Обновление системы

У панели администратора Blombooru есть встроенная система обновления, позволяющая вам с легкостью обновиться до последней доступной версии.

> [!WARNING]
> Всегда делайте бекап ваших данных перед обновлением! Несмотря на то, что обновления создаются, подразумевая  безопасность данных, неожиданные проблемы могут возникать, особенно при обновлении на major релиз или на dev билд.

#### Как обновиться?

1. Войдите в аккаунт администратора и перейдите к **Панели администратора**, 
2. Выберите вкладку **Система**.
3. Прокрутите до секции **Обновление системы**.
4. Нажмите **Проверить наличие обновления** для запроса информации о последней версии с GitHub.
5. Посмотрите список изменений по нажатию на **Просмотр списка изменений**
6. Если доступно обновление, нажмите:
   - **Обновиться до последней dev-версии** - Обновляет до последнего коммита ветки `main` 
   - **Обновиться до последнего релиза** - Обновляет до последнего релиза (рекомендуется)

Обновлятор автоматически запустит `git pull` (или `git checkout <tag>`) и выведет результат. После обновления, **перезапустите Blombooru** для применения изменений:

- **Docker:** `docker compose down && docker compose up -d`

> [!NOTE]
> Docker обновления в данный момент проводятся вручную. Система предупредит о том, что для обновления потребуется вручную выполнить `git pull` на хост-машине и пересобрать образ заново.

- **Python:** Остановите сервер (Ctrl+C) и запустите `python run.py` снова

#### Изменения зависимостей

Если обновление включает в себя изменения в `requirements.txt` или `docker-compose.yml`, обновлятор отобразит предупреждение. Вам понадобится:

- **Docker:** выполнить `docker compose down && docker compose up --build -d` для пересборки контейнера
- **Python:** Остановите сервер (Ctrl+C) и выполните `pip install -r requirements.txt` перед запуском `python run.py` вновь.

### API и сторонние приложения

В Blombooru включено **Danbooru v2 совместимое API**, позволяющее вам использовать существующие third-party Booru клиенты (Grabber, Tachiyomi, или BooruNav) для просмотра вашей коллекции.

#### Детали подключения

| Параметр | Значение |
|:--------|:------|
| **Server Type** | Danbooru v2 |
| **URL** | Ваш IP-адрес сервера и порт (e.g., `http://192.168.1.10:8000`) или ваш домен (e.g., `https://example.com`) |
| **Authentication** | Поддерживаются несколько методов (см. ниже) |

**Методы авторизации:**
- **Query parameters:** `login` + `api_key`
- **HTTP Basic Auth:** username + API ключ в кач-ве пароля
- **Bearer token:** `Authorization: Bearer <api_key>`

#### Поддерживаемые фичи

| Фича | Описание |
|:--------|:------------|
| **Posts** | Полная совместимость поиска, списков и медиа |
| **Tags** | Листинг тегов, поиск, автозаполнение и связанные теги |
| **Albums/Pools** | Blombooru альбомы идут как Danbooru "Pools" |
| **Artists** | Blombooru Artist теги идут как Artists endpoint |

> [!NOTE]
> Операции на запись (загрузка, редактирование, etc.) через API - read-only или отключены для предотвращения ошибок в third-party приложениях. Социальные функции, такие как голосование, добавление в избранное, комментарии, форумы, личные сообщения и вики-страницы, возвращают пустые результаты.

## Темы

Blombooru создан для легкой кастомизации тем.

- **CSS переменные:** Корневые цвета контроллируются CSS переменными описаными в стандартных темах.

- **Кастомные темы:** Для создания собственной темы, просто создайте новый `.css` файл в `frontend/static/themes/` папке, скопируйте целиком содержимое `default_dark.css` темы и начинайте творить! После этого, зарегистрируйте её в `backend/app/themes.py`, чтобы использовать.

Ваша новая тема автоматически появится в списке доступных в панели администратора.

## Технические детали

| Компонент | Технология |
|:----------|:-----------|
| **Backend** | FastAPI (Python) |
| **Frontend** | Tailwind CSS (локальный билд), Vanilla JavaScript, HTML |
| **БД** | PostgreSQL 17 |
| **Кеширование** | Redis 7+ (опционально) |
| **Общие теги** | Выделенный инстанс PostgreSQL для обмена тегами между инстансами (опционально) |
| **Хранилище медиа** | Локальная ФС с путями, относящимися с путями из ДБ. Оригинальные метаданные файлов всегда сохранены, но при желании могут быть очищены при шеринге медиа.|
| **Поддерживаемые форматы** | JPG, PNG, WEBP, GIF, MP4, WEBM |

## Отказ от ответственности

Это приложение задумано как self-hosted, single-user. Как единственный администратор, именно вы и только вы ответственны за весь контент, который вы загружаете, изменяете и распространяете с использованием этого ПО.

Убедитесь, что ваше использование соответствует всем применимым законам и нормам, особенно касаемо авторских прав и частной жизни всех и каждого, кто может быть изображен на файлах, загружаемых вами.

Разработчики и участники этого проекта **НЕ НЕСУТ ОТВЕТСТВЕННОСТИ** за любое незаконное, неправомерное или антиморальное использование и в принципе за контент, загружаемый любым пользователем. ПО распространяется "as is" без гарантий. С полной версией можно ознакомиться, перейдя по ссылке: [Отказ от ответственности](https://github.com/mrblomblo/blombooru/blob/main/DISCLAIMER.md).

## Лицензия

Этот проект имеет лицензию MIT License. Ознакомьтесь с файлом [Лицензии](https://github.com/mrblomblo/blombooru/blob/main/LICENSE.txt) для деталей.
